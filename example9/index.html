
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.2.15">
    
    
      
        <title>Tutorial 9 - Connecting To Multiple Backplanes - Python Banyan</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.c382b1dc.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.cc9b2e1e.min.css">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#multi-backplane-applications" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Python Banyan" class="md-header__button md-logo" aria-label="Python Banyan" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Python Banyan
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Tutorial 9  - Connecting To Multiple Backplanes
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Python Banyan" class="md-nav__button md-logo" aria-label="Python Banyan" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Python Banyan
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Welcome
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          User's Guide
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="User's Guide" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          User's Guide
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../users_guide/" class="md-nav__link">
        What Is Python Banyan?
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../install/" class="md-nav__link">
        Installation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../examples_intro/" class="md-nav__link">
        Introduction To The Tutorials
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/" class="md-nav__link">
        Base Class API Reference
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../example1/" class="md-nav__link">
        Tutorial 1  - A Simple Echo Server/Client
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../example2/" class="md-nav__link">
        Tutorial 2  - Adding Command Line Options To A Component
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../example3/" class="md-nav__link">
        Tutorial 3  - Distributed Applications
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../example4/" class="md-nav__link">
        Tutorial 4  - Applications From Components On Differing Platforms
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../example5/" class="md-nav__link">
        Tutorial 5  - Debugging Using The Monitor
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../example6/" class="md-nav__link">
        Tutorial 6  - Integrating With A GUI Event Loop
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../example7/" class="md-nav__link">
        Tutorial 7  - Installing Components As Executable Modules
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../example8/" class="md-nav__link">
        Tutorial 8  - Using the Banyan Launcher
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Tutorial 9  - Connecting To Multiple Backplanes
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Tutorial 9  - Connecting To Multiple Backplanes
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-banyan-base-multi-base-class" class="md-nav__link">
    The Banyan Base Multi Base Class
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-routing-specification-file-for-banyanbasemulti" class="md-nav__link">
    The Routing Specification File For BanyanBaseMulti
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-python-banyan-multi-base-class-code-in-detail" class="md-nav__link">
    The Python Banyan Multi Base Class Code In Detail
  </a>
  
    <nav class="md-nav" aria-label="The Python Banyan Multi Base Class Code In Detail">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#__init__" class="md-nav__link">
    95_init__
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#find_socket" class="md-nav__link">
    find_socket
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set_subscriber_topic" class="md-nav__link">
    set_subscriber_topic
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unsubscribe_topic" class="md-nav__link">
    unsubscribe_topic
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#publish_payload" class="md-nav__link">
    publish_payload
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#receive_loop" class="md-nav__link">
    receive_loop
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#incoming_message_processing" class="md-nav__link">
    incoming_message_processing
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clean_up" class="md-nav__link">
    clean_up
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-simple-working-example" class="md-nav__link">
    A Simple Working Example
  </a>
  
    <nav class="md-nav" aria-label="A Simple Working Example">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-notifier" class="md-nav__link">
    The Notifier
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-echo-client" class="md-nav__link">
    The Echo Client
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-multiechoserver" class="md-nav__link">
    The MultiEchoServer
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#routing-specification-file" class="md-nav__link">
    Routing Specification File
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-multiechoserver-code" class="md-nav__link">
    The MultiEchoServer Code
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-the-example" class="md-nav__link">
    Running The Example
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../example10/" class="md-nav__link">
        Tutorial 10 - Connecting Banyan To An MQTT Network
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../example11/" class="md-nav__link">
        Tutorial 11 - Physical Computing And GPIO
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../benchmark/" class="md-nav__link">
        Comparing Banyan and MQTT
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../about/" class="md-nav__link">
        About
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          The OneGPIO Project
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="The OneGPIO Project" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          The OneGPIO Project
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../gpio_intro/" class="md-nav__link">
        Introducing OneGPIO
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../common_messaging_protocol/" class="md-nav__link">
        The OneGPIO Messaging Protocol
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../banyan_gateways/" class="md-nav__link">
        An Introduction To OneGPIO Gateways
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../additional_gateways/" class="md-nav__link">
        Additional Banyan Gateways
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../one_gpio_demos/" class="md-nav__link">
        OneGPIO Demos
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-banyan-base-multi-base-class" class="md-nav__link">
    The Banyan Base Multi Base Class
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-routing-specification-file-for-banyanbasemulti" class="md-nav__link">
    The Routing Specification File For BanyanBaseMulti
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-python-banyan-multi-base-class-code-in-detail" class="md-nav__link">
    The Python Banyan Multi Base Class Code In Detail
  </a>
  
    <nav class="md-nav" aria-label="The Python Banyan Multi Base Class Code In Detail">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#__init__" class="md-nav__link">
    95_init__
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#find_socket" class="md-nav__link">
    find_socket
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set_subscriber_topic" class="md-nav__link">
    set_subscriber_topic
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unsubscribe_topic" class="md-nav__link">
    unsubscribe_topic
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#publish_payload" class="md-nav__link">
    publish_payload
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#receive_loop" class="md-nav__link">
    receive_loop
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#incoming_message_processing" class="md-nav__link">
    incoming_message_processing
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clean_up" class="md-nav__link">
    clean_up
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-simple-working-example" class="md-nav__link">
    A Simple Working Example
  </a>
  
    <nav class="md-nav" aria-label="A Simple Working Example">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-notifier" class="md-nav__link">
    The Notifier
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-echo-client" class="md-nav__link">
    The Echo Client
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-multiechoserver" class="md-nav__link">
    The MultiEchoServer
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#routing-specification-file" class="md-nav__link">
    Routing Specification File
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-multiechoserver-code" class="md-nav__link">
    The MultiEchoServer Code
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-the-example" class="md-nav__link">
    Running The Example
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<h1 id="multi-backplane-applications">Multi-Backplane Applications</h1>
<p>For the vast majority of Banyan applications, a single backplane is all that is needed to
handle all the
application's messaging needs. When using a single backplane configuration, there is no need to manually perform
message routing, since all components automatically connect to a <a href="../examples_intro/#the-banyan-backplane">common backplane.</a></p>
<p>However, there are occasions where you might like to design your component 
so that it can communicate with more than one backplane. Some possible
 scenarios for this configuration would be to provide message load balancing or a better
 separation of operational concerns. To support these types of configurations,
 a new base class, <a href="https://github.com/MrYsLab/python_banyan/blob/master/python_banyan/banyan_base_multi/banyan_base_multi.py"><strong><em>BanyanBaseMulti</em></strong>,</a>
 is required.</p>
<h2 id="the-banyan-base-multi-base-class">The <strong><em>Banyan Base Multi</em></strong> Base Class</h2>
<p>In many ways, the <strong><em>BanyanBaseMulti</em></strong>
 base class
is similar to the <a href="../examples_intro/#python-banyan-base-classes"><strong><em>BanyanBase</em></strong></a>
 class, but there is one significant difference. A <em>BanyanBaseMulti</em> component requires that
a backplane routing table be provided at initialization. This table is known as the <em>routing specification file</em>.</p>
<p>Note: <em>BanyanBase</em> and <em>BanyanBaseMulti</em> components may communicate with each other without restriction.
No coding changes or message format changes are required.</p>
<h2 id="the-routing-specification-file-for-banyanbasemulti">The Routing Specification File For <strong><em>BanyanBaseMulti</em></strong></h2>
<p>Every BanyanBaseMulti component requires access to a unique comma-delimited
 routing specification file. The name and path of this file
is a required component input parameter.</p>
<p>Let's explore the format of the specification file.</p>
<p>The header and first line of a routing specification file is:</p>
<pre><code>backplane_name,ip_address,subscriber_port,subscriber_topic,publisher_port

</code></pre>
<p>The <strong><em>backplane_name</em></strong> field is a unique ID string given to each of the connected backplanes.
The IDs are used
to de-reference publisher and subscriber connections.</p>
<p>The <strong><em>ip_address</em></strong> field is the IP address of the given backplane.
Backplanes that share a single IP address are differentiated by
having unique subscriber and publisher ports.</p>
<p>The <strong><em>subscriber_port</em></strong> specifies the subscriber port for the given backplane.</p>
<p>The <strong><em>subscriber_topic</em></strong> is an optional Python list of subscriber topics established at
the instantiation of the component. If a single topic is to be specified, it still must be
entered as a Python list.</p>
<p><strong>IMPORTANT NOTE:</strong> Even though the topics are strings, the individual topic strings
must not be enclosed in quotes. Instead, the whole list, including the brackets,
  is enclosed in quotes. Also, there must
not be any spaces after the commas. For example, if the topics
are <strong>start</strong>, and <strong>finish</strong>, the subscriber_topic field is specified as: <strong>"[start,finish]"</strong></p>
<p>The <strong><em>publisher_port</em></strong> specifies the publisher port for the given backplane.</p>
<p>Here is sample of a <a href="https://github.com/MrYsLab/python_banyan/blob/master/examples/banyan_base_multi/multi_driver_spec.csv"><em>routing specification file</em></a>
 for a component that connects to 5 backplanes.</p>
<pre><code>backplane_name,ip_address,subscriber_port,subscriber_topic,publisher_port
BP1,192.168.2.194,43127,&quot;[reply]&quot;,43126
BP2,192.168.2.194,43125,&quot;[reply]&quot;,43124
BP3,192.168.2.177,43125,&quot;[]&quot;,43124
BP4,192.168.2.199,43125,&quot;[run_motors,light_leds]&quot;,
BP5,192.168.2.133,,&quot;[run_motors,light_leds]&quot;,43124
</code></pre>
<p>Let's launch a sample BanyanBaseMulti component called <a href="https://github.com/MrYsLab/python_banyan/blob/master/examples/banyan_base_multi/multi_driver.py"><strong><em>MultiDriver</em></strong>.</a> 
When the component initializes, it will read the routing specification file, and print out
its interpretation of that file as its console header. Let's look at that console header.</p>
<pre><code>Using Backplane Descriptor File:  multi_driver_spec.csv

************************************************************

MultiDriver using BP1 Black plane at IP Address: 192.168.2.194
    Subscriber Port = 43127
        Subscribed to topic: reply
    Publisher  Port = 43126
MultiDriver using BP2 Black plane at IP Address: 192.168.2.194
    Subscriber Port = 43125
        Subscribed to topic: reply
    Publisher  Port = 43124
MultiDriver using BP3 Black plane at IP Address: 192.168.2.177
    Subscriber Port = 43125
        Subscribed to topic:
    Publisher  Port = 43124
MultiDriver using BP4 Black plane at IP Address: 192.168.2.199
    Subscriber Port = 43125
        Subscribed to topic: run_motors
        Subscribed to topic: light_leds
    Publisher  Port = None Specified
MultiDriver using BP5 Black plane at IP Address: 192.168.2.133
    Subscriber Port = None Specified
    Publisher  Port = 43124

Loop Time = 0.1 seconds

************************************************************
</code></pre>
<p>Notice that for BP1 and BP2, all fields are specified.
Since they share a common IP address, their ports have different values.</p>
<p>For BP3, no topic list was specified, and therefore the "Subscribed to topic" for BPI3 shows no topics.</p>
<p>BP4 specifies multiple subscriber topics and a subscriber port, but no publisher
port. This is a valid case when the component does not publish any messages.</p>
<p>BP5 has no subscriber port specified and no topics specified. Because there is no subscriber
port, topics are not listed. For BP5, this component acts only as a publisher.</p>
<p>A <a href="../example9/#a-simple-working-example">simple working example</a> is discussed below if you would like to try using
BanyanBaseMulti.</p>
<h2 id="the-python-banyan-multi-base-class-code-in-detail">The Python Banyan Multi Base Class Code In Detail</h2>
<p>Lines 1 through 66 should seem very similar to those for the
<a href="../examples_intro/#python-banyan-base-class">BanyanBase</a> base class.</p>
<pre><code>     1  &quot;&quot;&quot;
     2  banyan_base_multi.py
     3
     4   Copyright (c) 2016 - 2019 Alan Yorinks All right reserved.
     5
     6   Python Banyan is free software; you can redistribute it and/or
     7   modify it under the terms of the GNU AFFERO GENERAL PUBLIC LICENSE
     8   Version 3 as published by the Free Software Foundation; either
     9   or (at your option) any later version.
    10   This library is distributed in the hope that it will be useful,
    11   but WITHOUT ANY WARRANTY; without even the implied warranty of
    12   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
    13   General Public License for more details.
    14
    15   You should have received a copy of the GNU AFFERO GENERAL PUBLIC LICENSE
    16   along with this library; if not, write to the Free Software
    17   Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
    18
    19  &quot;&quot;&quot;
    20  from __future__ import unicode_literals
    21
    22  # Use argparse and signal if you wish to implement the argparse
    23  # code located at the bottom of this file
    24  # import argparse
    25  # import signal
    26
    27  import csv
    28  import sys
    29  import time
    30  import itertools
    31  import msgpack
    32  import msgpack_numpy as m
    33  import umsgpack
    34  import zmq
    35  import os
    36
    37
    38  # noinspection PyMethodMayBeStatic
    39  class BanyanBaseMulti(object):
    40      &quot;&quot;&quot;
    41
    42      This is the base class for Python Banyan components that wish to connect to multiple back planes.
    43      It requires the user to create a .csv descriptor file to describe the back planes and their
    44      addresses/ports and subscription topics.
    45
    46      The .csv file has the following format. This line must be the first line in the file:
    47
    48      backplane_name,ip_address,subscriber_port,subscriber_topic,publisher_port
    49
    50      backplane_name: a unique identifier string for backplane - for informational purposes only
    51      ip_address: IP address of the computer that the backplane is running on
    52      subscriber_port: port number assigned to the backplane's subscriber port
    53      subscriber_topic: this is an optional list of subscription topics
    54      publisher_port: port number assigned to the backplane's publisher port
    55
    56
    57      There should be an entry in this file for each backplane that the component needs to connect to.
    58
    59      This class encapsulates zeromq and message pack functionality. Its methods should be overridden by the user
    60      in the derived class to meet the needs of the component.
    61
    62      To import into  the derived class use:
    63
    64             from python_banyan.banyan_base_multi import BanyanBaseMulti
    65
    66      &quot;&quot;&quot;
</code></pre>
<h3 id="__init__">__init__</h3>
<p>The <strong>__init__</strong> method requires the name and path to a routing specification file. Similar to a
BanyanBase component, it accepts a process name, a loop_time, and a flag to process numpy data.</p>
<p>Lines 87 and 88 establish "constants" for the socket types. This is used in the <a href="#find_socket"><em>find_socket</em></a>
method discussed below.</p>
<p>Lines 94 and 95 verify that a routing specification file can be found.</p>
<p>Lines 100 through 108 establish instance variables used by the class.</p>
<p>Lines 118 through 173, read and validate the routing specification file and print
out the component's "header" data to the console.</p>
<pre><code>    68      def __init__(self, back_plane_csv_file=None, process_name='None',
    69                   loop_time=.1, numpy=False, connect_time=0.3):
    70          &quot;&quot;&quot;
    71          The __init__ method sets up all the ZeroMQ &quot;plumbing&quot;
    72  
    73          :param back_plane_csv_file: full path to .csv file with backplane descriptors
    74  
    75          :param process_name: identifier for your component printed at startup on the console
    76  
    77          :param loop_time: receive loop sleep time
    78  
    79          :param numpy: Set true if you wish to include numpy matrices in your messages
    80  
    81          :param connect_time: a short delay to allow the component to connect to the Backplane
    82  
    83          :return:
    84          &quot;&quot;&quot;
    85  
    86          # socket type - used for calls to find_socket
    87          self.SUB_SOCK = 0
    88          self.PUB_SOCK = 1
    89  
    90          if back_plane_csv_file is None:
    91              raise ValueError('You must specify a valid .csv backplane descriptor file')
    92  
    93          # file specified, make sure it exists
    94          if not os.path.isfile(back_plane_csv_file):
    95              raise ValueError(&quot;Can't find backplane configuration file&quot;)
    96  
    97          if process_name == 'None':
    98              print('Warning: No Process Name Was Specified')
    99  
   100          self.numpy = numpy
   101  
   102          self.connect_time = connect_time
   103  
   104          # if using numpy apply the msgpack_numpy monkey patch
   105          if numpy:
   106              m.patch()
   107  
   108          self.loop_time = loop_time
   109  
   110          # get a zeromq context
   111          self.my_context = zmq.Context()
   112  
   113          # a list of dictionaries describing connections to the back planes
   114          self.backplane_table = []
   115  
   116          print(&quot;\nUsing Backplane Descriptor File: &quot;, back_plane_csv_file)
   117  
   118          with open(back_plane_csv_file) as csvfile:
   119              reader = csv.DictReader(csvfile)
   120              print('\n************************************************************\n')
   121              for row in reader:
   122                  # make sure backplane name is unique
   123                  if any(d['backplane_name'] == row['backplane_name'] for d in self.backplane_table):
   124                      raise RuntimeError('Duplicate Back Plane Name - check your .csv file')
   125  
   126                  print(process_name + ' using ' + row['backplane_name'] + ' Black plane at IP Address: ' +
   127                        row['ip_address'])
   128  
   129                  # setup a publisher and subscriber for each backplane
   130                  subscriber = None
   131                  if row['subscriber_port']:
   132                      subscriber = self.my_context.socket(zmq.SUB)
   133                      connect_string = &quot;tcp://&quot; + row['ip_address'] + ':' + row['subscriber_port']
   134                      subscriber.connect(connect_string)
   135  
   136                  publisher = None
   137                  if row['publisher_port']:
   138                      publisher = self.my_context.socket(zmq.PUB)
   139                      connect_string = &quot;tcp://&quot; + row['ip_address'] + ':' + row['publisher_port']
   140                      publisher.connect(connect_string)
   141  
   142                  # get topics and subscribe to them
   143                  # test that topic string has a leading and trailing []
   144                  if row['subscriber_port']:
   145                      print('    Subscriber Port = ' + row['subscriber_port'])
   146                      topic_list = row['subscriber_topic']
   147                      if '[' not in topic_list:
   148                          raise RuntimeError('Topic field must begin with &quot;[&quot; and end with &quot;]&quot; ')
   149                      if ']' not in topic_list:
   150                          raise RuntimeError('Topic field must begin with &quot;[&quot; and end with &quot;]&quot; ')
   151  
   152                      # make sure that the topic string does not contain a space character
   153                      if ' ' in topic_list:
   154                          raise RuntimeError('Topics may not contain a space character')
   155  
   156                      topic_list = topic_list[1:-1].split(',')
   157  
   158                      # subscribe to topics in list
   159                      for t in topic_list:
   160                          print('        Subscribed to topic: ' + t)
   161                          self.set_subscriber_topic(t, subscriber)
   162                  else:
   163                      print('    Subscriber Port = None Specified')
   164  
   165                  if row['publisher_port']:
   166                      print('    Publisher  Port = ' + row['publisher_port'])
   167                  else:
   168                      print('    Publisher  Port = None Specified')
   169  
   170                  # update backplane table with new entry
   171                  self.backplane_table.append(
   172                      {'backplane_name': row['backplane_name'], 'subscriber': subscriber,
   173                       'publisher': publisher})
   174  
   175              # wait for the last Backplane TCP connection
   176              time.sleep(self.connect_time)
   177  
   178              print()
   179              print('Loop Time = ' + str(loop_time) + ' seconds\n')
   180              print('************************************************************')
</code></pre>
<h3 id="find_socket">find_socket</h3>
<p>The <strong><em>find_socket</em></strong> method accepts a backplane name specified in the routing
 specification table and a socket type (publisher or subscriber) as input parameters. It returns
a socket connection for publishing messages to or receiving messages from the specified backplane.</p>
<pre><code>   182      def find_socket(self, backplane, socket_type):
   183          &quot;&quot;&quot;
   184          Find a publisher or subscriber in the backplane table and return a ZMQ socket reference
   185  
   186          :param backplane: backplane name entry in table
   187  
   188          :param socket_type: publisher or subscriber
   189  
   190          :return: socket reference or None
   191          &quot;&quot;&quot;
   192          valid_socket_types = [self.PUB_SOCK, self.SUB_SOCK]
   193  
   194          if socket_type in valid_socket_types:
   195              try:
   196                  entry = next(item for item in self.backplane_table if item.get(&quot;backplane_name&quot;) == backplane)
   197                  if socket_type == self.PUB_SOCK:
   198                      rval = entry['publisher']
   199                  else:
   200                      rval = entry['subscriber']
   201                  return rval
   202  
   203              except StopIteration:
   204                  raise StopIteration(backplane + ' not found in table.')
   205          else:
   206              raise ValueError(socket_type + ' is an illegal socket_type')
</code></pre>
<h3 id="set_subscriber_topic">set_subscriber_topic</h3>
<p>The <strong><em>set_subscriber_topic</em></strong> method associates a subscription topic with the given subscriber_socket
connection.</p>
<pre><code>   208      def set_subscriber_topic(self, topic, subscriber_socket):
   209          &quot;&quot;&quot;
   210          This method sets a subscriber topic.
   211  
   212          You can subscribe to multiple topics by calling this method for
   213          each topic.
   214  
   215          :param topic: A topic string
   216  
   217          :param subscriber_socket: subscriber socket
   218  
   219          :return:
   220          &quot;&quot;&quot;
   221          if sys.version_info[0] &lt; 3:
   222              try:
   223                  topic = topic.encode()
   224              except AttributeError:
   225                  raise TypeError('Publish topic must be python_banyan string', 'topic')
   226          if not type(topic) is str:
   227              raise TypeError('Subscriber topic must be python_banyan string')
   228  
   229          if subscriber_socket:
   230              subscriber_socket.setsockopt(zmq.SUBSCRIBE, topic.encode())
   231  
   232          else:
   233              raise ValueError('set_subscriber_topic: socket is None')
   234  
</code></pre>
<h3 id="unsubscribe_topic">unsubscribe_topic</h3>
<p>The <strong><em>unsubscribe_topic</em></strong> method allows one to unsubscribe from a topic for a backplane subscriber
socket connection.</p>
<pre><code>   235      def unsubscribe_topic(self, topic, subscriber_socket):
   236          &quot;&quot;&quot;
   237          This method un-subscribes from a topic.
   238          
   239          :param topic: A topic string
   240  
   241          :param subscriber_socket: subscriber socket
   242  
   243          :return:
   244          &quot;&quot;&quot;
   245          if sys.version_info[0] &lt; 3:
   246              try:
   247                  topic = topic.encode()
   248              except AttributeError:
   249                  raise TypeError('Publish topic must be python_banyan string', 'topic')
   250          if not type(topic) is str:
   251              raise TypeError('Subscriber topic must be python_banyan string')
   252  
   253          if subscriber_socket:
   254              subscriber_socket.unsubscribe(topic.encode())
   255  
   256          else:
   257              raise ValueError('set_subscriber_topic: socket is None')

</code></pre>
<h3 id="publish_payload">publish_payload</h3>
<p>The <strong><em>publish_payload</em></strong> method is very similar to that for BanyanBase. </p>
<p><strong>IMPORTANT NOTE:</strong> If the topic
string is "BROADCAST," then the message is published to all backplanes containing publisher
ports specified in the routing specification file.</p>
<pre><code>   259      def publish_payload(self, payload, publisher_socket, topic=''):
   260          &quot;&quot;&quot;
   261          This method will publish a python_banyan payload and its associated topic
   262          
   263          :param payload:  Protocol message to be published
   264  
   265          :param publisher_socket: Publisher socket - handle to socket or &quot;BROADCAST&quot; to send to
   266                                   all connected publisher sockets
   267  
   268          :param topic: A string value for message topic
   269  
   270          :return: 
   271          &quot;&quot;&quot;
   272          if sys.version_info[0] &lt; 3:
   273              try:
   274                  topic = topic.encode()
   275              except AttributeError:
   276                  raise TypeError('Publish topic must be python_banyan string', 'topic')
   277          if not type(topic) is str:
   278              raise TypeError('Publish topic must be python_banyan string', 'topic')
   279  
   280          # create python_banyan message pack payload
   281          if self.numpy:
   282              message = msgpack.packb(payload, default=m.encode)
   283          else:
   284              message = umsgpack.packb(payload)
   285  
   286          pub_envelope = topic.encode()
   287          if publisher_socket == &quot;BROADCAST&quot;:
   288              for element in self.backplane_table:
   289                  if element['publisher']:
   290                      element['publisher'].send_multipart([pub_envelope, message])
   291          else:
   292  
   293              if publisher_socket:
   294                  publisher_socket.send_multipart([pub_envelope, message])
   295              else:
   296                  raise ValueError('Invalid publisher socket')
</code></pre>
<h3 id="receive_loop">receive_loop</h3>
<p>The <strong><em>receive_loop</em></strong> cycles through all of the backplane subscriber sockets to see if any 
messages need to be processed. If so, it calls the <em>incoming_message_processing</em> method.</p>
<pre><code>   298      def receive_loop(self):
   299          &quot;&quot;&quot;
   300          This is the receive loop for zmq messages.
   301  
   302          This method may be overwritten to meet the needs
   303          of the application before handling received messages.
   304  
   305          :return:
   306          &quot;&quot;&quot;
   307          for element in itertools.cycle(self.backplane_table):
   308              if element['subscriber']:
   309                  try:
   310                      data = element['subscriber'].recv_multipart(zmq.NOBLOCK)
   311                      if self.numpy:
   312                          payload = msgpack.unpackb(data[1], object_hook=m.decode)
   313                          self.incoming_message_processing(data[0].decode(), payload)
   314                      else:
   315                          self.incoming_message_processing(data[0].decode(), umsgpack.unpackb(data[1]))
   316                  except zmq.error.Again:
   317                      try:
   318                          time.sleep(self.loop_time)
   319                      except KeyboardInterrupt:
   320                          self.clean_up()
   321                          sys.exit(0)
   322                  except AttributeError:
   323                      raise
   324
</code></pre>
<h3 id="incoming_message_processing">incoming_message_processing</h3>
<p>This method needs to be overridden to handle the incoming messages.</p>
<pre><code>   325      def incoming_message_processing(self, topic, payload):
   326          &quot;&quot;&quot;
   327          Override this method with a custom python_banyan message processor for subscribed messages
   328  
   329          :param topic: Message Topic string
   330  
   331          :param payload: Message Data
   332  
   333          :return:
   334          &quot;&quot;&quot;
   335          print('this method should be overwritten in the child class', topic, payload)
</code></pre>
<h3 id="clean_up">clean_up</h3>
<p>The <strong><em>clean_up</em></strong> method iterates through all the backplanes and closes their connections.</p>
<pre><code>   337      def clean_up(self):
   338          &quot;&quot;&quot;
   339          Clean up before exiting - override if additional cleanup is necessary
   340  
   341          :return:
   342          &quot;&quot;&quot;
   343          for element in self.backplane_table:
   344              if element['publisher']:
   345                  element['publisher'].close()
   346              if element['subscriber']:
   347                  element['subscriber'].close()
   348          self.my_context.term()
</code></pre>
<h2 id="a-simple-working-example">A Simple Working Example</h2>
<p>This section provides a simple demonstration of a Banyan application that makes use
of the BanyanBaseMulti base class. For this example, 2 backplanes are invoked, each on a
different computer. The example can be easily modified to run both backplanes 
on a single computer by adjusting the routing specification file's values.</p>
<p>In addition to the two backplanes, the application consists of three
Banyan components. The first component is a reuse of
<a href="https://github.com/MrYsLab/python_banyan/blob/master/examples/echo_cmdline_client.py"><strong><em>echo_cmdline_client.py</em></strong>,</a> and it
resides on computer1. The second
 component, <a href="https://github.com/MrYsLab/python_banyan/blob/master/examples/banyan_base_multi/simple_demo/multi_echo_server.py"><strong><em>multi_echo_server.py</em></strong></a>
  derived from <em>BanyanBaseMulti</em>
  The third component, <a href="https://github.com/MrYsLab/python_banyan/blob/master/examples/banyan_base_multi/simple_demo/notifier.py"><strong><em>notifier.py</em></strong></a>,
 derived from <em>BanyanBase,</em> resides on computer2.</p>
<p>Backplane1 resides on computer1, and backplane2 resides on computer2.</p>
<p>The client publishes messages to backplane1, and the server echoes these messages back within backplane1. As each
message is received by the server, it tests to see if the message number is 0. Message number 0
signals that this is the final message.
If the message number is 0,
the server then publishes a "notifier" message routed to backplane2.</p>
<p><img align="center" src="../images/multix.png"></p>
<h3 id="the-notifier">The Notifier</h3>
<p>The code for the Notifier is extremely simple. It registers to receive messages with a 'notice' topic
and when a message is received, prints 'Notification Received':</p>
<pre><code>     1  &quot;&quot;&quot;
     2  notifier.py
     3  
     4   Copyright (c) 2018 - 2019 Alan Yorinks All right reserved.
     5  
     6   Python Banyan is free software; you can redistribute it and/or
     7   modify it under the terms of the GNU AFFERO GENERAL PUBLIC LICENSE
     8   Version 3 as published by the Free Software Foundation; either
     9   or (at your option) any later version.
    10   This library is distributed in the hope that it will be useful,
    11   but WITHOUT ANY WARRANTY; without even the implied warranty of
    12   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
    13   General Public License for more details.
    14  
    15   You should have received a copy of the GNU AFFERO GENERAL PUBLIC LICENSE
    16   along with this library; if not, write to the Free Software
    17   Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
    18  
    19  &quot;&quot;&quot;
    20  import sys
    21  import time
    22  
    23  from python_banyan.banyan_base import BanyanBase
    24  
    25  
    26  class Notifier(BanyanBase):
    27      &quot;&quot;&quot;
    28      This class is a simple Banyan echo server
    29  
    30      &quot;&quot;&quot;
    31  
    32      def __init__(self, ):
    33  
    34          # initialize the parent
    35          super(Notifier, self).__init__(process_name='Notifier')
    36  
    37          # allow time for base class to initialize publisher/subscriber connections
    38          time.sleep(.3)
    39  
    40          # subscribe to receive 'echo' messages from the client
    41          self.set_subscriber_topic('notice')
    42  
    43          # wait for messages to arrive
    44          try:
    45              self.receive_loop()
    46          except KeyboardInterrupt:
    47              self.clean_up()
    48              sys.exit(0)
    49  
    50      def incoming_message_processing(self, topic, payload):
    51          &quot;&quot;&quot;
    52          Process incoming messages from the client
    53          :param topic: message topic
    54          :param payload: message payload
    55          :return:
    56          &quot;&quot;&quot;
    57          print('Notification Received!')
    58  
    59  
    60  def notifier():
    61      Notifier()
    62  
    63  
    64  if __name__ == '__main__':
    65      notifier()

</code></pre>
<h3 id="the-echo-client">The Echo Client</h3>
<p>We are reusing the <a href="https://github.com/MrYsLab/python_banyan/blob/master/examples/echo_cmdline_client.py"><em>echo_cmdline_client</em></a> unmodified.</p>
<h3 id="the-multiechoserver">The MultiEchoServer</h3>
<p>The server is derived from BanyanBaseMulti.
Let us begin by examining its associated <em>routing specification file</em>.</p>
<h3 id="routing-specification-file">Routing Specification File</h3>
<pre><code>backplane_name,ip_address,subscriber_port,subscriber_topic,publisher_port
BP1,192.168.2.190,43125,&quot;[echo]&quot;,43124
BP2,192.168.2.180,43125,&quot;[]&quot;,43124
</code></pre>
<p>BP1 is the backplane that is running on 192.168.2.190 and the server subscribes to the <em>echo</em> topic on backplane1.</p>
<p>BP2 is the backplane that is running 192.168.2.180, and the server publishes <em>notifier</em> messages
to backplane2.</p>
<h2 id="the-multiechoserver-code">The MultiEchoServer Code</h2>
<p>Lines 39 and 42 establish the sockets for each of the backplanes. It uses the <a href="#find_socket"><em>find_socket</em></a> method to retrieve
the publisher sockets for the backplanes. It uses the names of the backplanes from the <a href="#routing-specification-file">routing specification file</a>
to retrieve the sockets.</p>
<p>Line 59 echoes the incoming messages from the client. If the message number is 0, then
line 62 publishes a <em>notice</em> message to backplane2.</p>
<pre><code>     1  &quot;&quot;&quot;
     2  multi_echo_server.py
     3  
     4   Copyright (c) 2016-2019 Alan Yorinks All right reserved.
     5  
     6   Python Banyan is free software; you can redistribute it and/or
     7   modify it under the terms of the GNU AFFERO GENERAL PUBLIC LICENSE
     8   Version 3 as published by the Free Software Foundation; either
     9   or (at your option) any later version.
    10   This library is distributed in the hope that it will be useful,
    11   but WITHOUT ANY WARRANTY; without even the implied warranty of
    12   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
    13   General Public License for more details.
    14  
    15   You should have received a copy of the GNU AFFERO GENERAL PUBLIC LICENSE
    16   along with this library; if not, write to the Free Software
    17   Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
    18  
    19  &quot;&quot;&quot;
    20  import sys
    21  import time
    22  
    23  from python_banyan.banyan_base_multi import BanyanBaseMulti
    24  
    25  
    26  class MultiEchoServer(BanyanBaseMulti):
    27      &quot;&quot;&quot;
    28      This class is a simple Banyan echo server
    29  
    30      &quot;&quot;&quot;
    31  
    32      def __init__(self, ):
    33  
    34          # initialize the parent
    35          super(MultiEchoServer, self).__init__(back_plane_csv_file='spec.csv', process_name='MultiDriver')
    36  
    37          # find the sockets in the table for the 2 backplanes
    38          # socket a is to reply to messages from the client
    39          self.socket_a = self.find_socket(&quot;BP1&quot;, self.PUB_SOCK)
    40  
    41          # socket b is to send the notification messages
    42          self.socket_b = self.find_socket(&quot;BP2&quot;, self.PUB_SOCK)
    43  
    44          # wait for messages to arrive
    45          try:
    46              self.receive_loop()
    47          except KeyboardInterrupt:
    48              self.clean_up()
    49              sys.exit(0)
    50  
    51      def incoming_message_processing(self, topic, payload):
    52          &quot;&quot;&quot;
    53          Process incoming messages from the client
    54          :param topic: message topic
    55          :param payload: message payload
    56          :return:
    57          &quot;&quot;&quot;
    58          if topic == 'echo':
    59              self.publish_payload(payload, self.socket_a, 'reply')
    60              print('Message number:', payload['message_number'])
    61              if payload['message_number'] == 0:
    62                  self.publish_payload({'message': 'got it', 'id': 'b'},
    63                                      self.socket_b, 'notice')
    64  
    65  
    66  def multi_echo_server():
    67      MultiEchoServer()
    68  
    69  
    70  if __name__ == '__main__':
    71      multi_echo_server()

</code></pre>
<h2 id="running-the-example">Running The Example</h2>
<p>First, we start a backplane, a monitor and multi_echo_server.py on 192.168.2.190.
<img align="center" src="../images/multi_server1.png"></p>
<p>The next step is to start a backplane <em>notifier.py</em> on 192.168.2.180.</p>
<p><img align="center" src="../images/notifier1.png"></p>
<p>Finally, we start the echo client on 192.168.2.190. It sends
its 10 messages. When the server receives message number 0, it sends
its notification message.</p>
<p><img align="center" src="../images/notifier2.png"></p>
<p>Looking at the monitor on 192.168.2.190, we see:</p>
<p><img align="center" src="../images/multi_serv_mon2.png"></p>
<p>And the monitor on 192.168.2.180 shows:</p>
<p><img align="center" src="../images/notifier_mon2.png"></p>
<p><br>
<br>
Copyright (C) 2017-2020 Alan Yorinks All Rights Reserved</p>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../example8/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Tutorial 8  - Using the Banyan Launcher" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Tutorial 8  - Using the Banyan Launcher
            </div>
          </div>
        </a>
      
      
        
        <a href="../example10/" class="md-footer__link md-footer__link--next" aria-label="Next: Tutorial 10 - Connecting Banyan To An MQTT Network" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Tutorial 10 - Connecting Banyan To An MQTT Network
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.2a1c317c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.a6c66575.min.js"></script>
      
    
  </body>
</html>