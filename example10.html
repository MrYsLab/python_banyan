


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1, mkdocs-material-5.1.6">
    
    
      
        <title>Tutorial 10 - Connecting Banyan To An MQTT Network - Python Banyan</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.4b9ffd7b.min.css">
      
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    <body dir="ltr">
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#connecting-banyan-applications-to-mqtt" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="." title="Python Banyan" class="md-header-nav__button md-logo" aria-label="Python Banyan">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Python Banyan
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Tutorial 10 - Connecting Banyan To An MQTT Network
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="." title="Python Banyan" class="md-nav__button md-logo" aria-label="Python Banyan">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Python Banyan
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="index.html" title="Welcome" class="md-nav__link">
      Welcome
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      User's Guide
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="User's Guide" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        User's Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="users_guide.html" title="What Is Python Banyan?" class="md-nav__link">
      What Is Python Banyan?
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="install.html" title="Installation" class="md-nav__link">
      Installation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="examples_intro.html" title="Introduction To The Tutorials" class="md-nav__link">
      Introduction To The Tutorials
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="api.html" title="Base Class API Reference" class="md-nav__link">
      Base Class API Reference
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="example1.html" title="Tutorial 1 - A Simple Echo Server/Client" class="md-nav__link">
      Tutorial 1  - A Simple Echo Server/Client
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="example2.html" title="Tutorial 2 - Adding Command Line Options To A Component" class="md-nav__link">
      Tutorial 2  - Adding Command Line Options To A Component
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="example3.html" title="Tutorial 3 - Distributed Applications" class="md-nav__link">
      Tutorial 3  - Distributed Applications
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="example4.html" title="Tutorial 4 - Applications From Components On Differing Platforms" class="md-nav__link">
      Tutorial 4  - Applications From Components On Differing Platforms
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="example5.html" title="Tutorial 5 - Debugging Using The Monitor" class="md-nav__link">
      Tutorial 5  - Debugging Using The Monitor
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="example6.html" title="Tutorial 6 - Integrating With A GUI Event Loop" class="md-nav__link">
      Tutorial 6  - Integrating With A GUI Event Loop
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="example7.html" title="Tutorial 7 - Installing Components As Executable Modules" class="md-nav__link">
      Tutorial 7  - Installing Components As Executable Modules
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="example8.html" title="Tutorial 8 - Using the Banyan Launcher" class="md-nav__link">
      Tutorial 8  - Using the Banyan Launcher
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="example9.html" title="Tutorial 9 - Connecting To Multiple Backplanes" class="md-nav__link">
      Tutorial 9  - Connecting To Multiple Backplanes
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Tutorial 10 - Connecting Banyan To An MQTT Network
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"/></svg>
        </span>
      </label>
    
    <a href="example10.html" title="Tutorial 10 - Connecting Banyan To An MQTT Network" class="md-nav__link md-nav__link--active">
      Tutorial 10 - Connecting Banyan To An MQTT Network
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#example-1-pure-mqtt-publish-and-subscribe" class="md-nav__link">
    Example 1: Pure MQTT Publish And Subscribe
  </a>
  
    <nav class="md-nav" aria-label="Example 1: Pure MQTT Publish And Subscribe">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mqtt-publisher" class="md-nav__link">
    MQTT Publisher
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mqtt-subscriber" class="md-nav__link">
    MQTT Subscriber
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-2-publishing-a-banyan-message-to-the-mqtt-network" class="md-nav__link">
    Example 2: Publishing a Banyan Message To the MQTT Network
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-3-publishing-an-mqtt-message-to-the-banyan-network" class="md-nav__link">
    Example 3: Publishing an MQTT Message To the Banyan Network
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="example11.html" title="Tutorial 11 - Physical Computing And GPIO" class="md-nav__link">
      Tutorial 11 - Physical Computing And GPIO
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="benchmark.html" title="Comparing Banyan and MQTT" class="md-nav__link">
      Comparing Banyan and MQTT
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="about.html" title="About" class="md-nav__link">
      About
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      The OneGPIO Project
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="The OneGPIO Project" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        The OneGPIO Project
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="gpio_intro.html" title="Introducing OneGPIO" class="md-nav__link">
      Introducing OneGPIO
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="common_messaging_protocol.html" title="The OneGPIO Messaging Protocol" class="md-nav__link">
      The OneGPIO Messaging Protocol
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="banyan_gateways.html" title="An Introduction To OneGPIO Gateways" class="md-nav__link">
      An Introduction To OneGPIO Gateways
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="additional_gateways.html" title="Additional Banyan Gateways" class="md-nav__link">
      Additional Banyan Gateways
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="one_gpio_demos.html" title="OneGPIO Demos" class="md-nav__link">
      OneGPIO Demos
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#example-1-pure-mqtt-publish-and-subscribe" class="md-nav__link">
    Example 1: Pure MQTT Publish And Subscribe
  </a>
  
    <nav class="md-nav" aria-label="Example 1: Pure MQTT Publish And Subscribe">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mqtt-publisher" class="md-nav__link">
    MQTT Publisher
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mqtt-subscriber" class="md-nav__link">
    MQTT Subscriber
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-2-publishing-a-banyan-message-to-the-mqtt-network" class="md-nav__link">
    Example 2: Publishing a Banyan Message To the MQTT Network
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-3-publishing-an-mqtt-message-to-the-banyan-network" class="md-nav__link">
    Example 3: Publishing an MQTT Message To the Banyan Network
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  
                
                
                <h1 id="connecting-banyan-applications-to-mqtt">Connecting Banyan Applications To MQTT</h1>
<p><img align="center" src="../images/mqtt_gateway.png"></p>
<p>The <a href="https://github.com/MrYsLab/python_banyan/blob/master/python_banyan/utils/mqtt_gateway/mqtt_gateway.py">MQTT Gateway</a>
 is a Banyan component that can subscribe to receive MQTT messages
from the MQTT network, and then forward those messages to the Banyan network.
It also can subscribe to receive Banyan messages, and then forward those to the MQTT network.</p>
<p>The MQTT Gateway is installed as a command-line executable when
Python Banyan is installed. To invoke the MQTT Gateway, open a terminal
window and type:</p>
<p><strong>mgw</strong></p>
<p>There are several optional command-line parameters
available in mgw. For the examples that follow, the default values are accepted</p>
<p>Here is a list of all the optional parameters.</p>
<pre><code>mgw -h

usage: mqtt_gateway.py [-h] [-a MQTT_IP_ADDRESS] [-b BACK_PLANE_IP_ADDRESS]
                       [-d MQTT_PORT] [-e BANYAN_PUB_TOPIC]
                       [-g BANYAN_SUB_TOPICS [BANYAN_SUB_TOPICS ...]]
                       [-i MQTT_PUB_TOPIC]
                       [-j MQTT_SUB_TOPICS [MQTT_SUB_TOPICS ...]]
                       [-n PROCESS_NAME] [-p PUBLISHER_PORT]
                       [-s SUBSCRIBER_PORT] [-t LOOP_TIME]

optional arguments:
  -h, --help            show this help message and exit
  -a MQTT_IP_ADDRESS    IP address of mqtt broker
  -b BACK_PLANE_IP_ADDRESS
                        None or IP address used by Back Plane
  -d MQTT_PORT          MQTT Port Number
  -e BANYAN_PUB_TOPIC   Topic for messages to MQTT
  -g BANYAN_SUB_TOPICS [BANYAN_SUB_TOPICS ...]
                        Banyan topics space-delimited: topic1 topic2 topic3
  -i MQTT_PUB_TOPIC     Topic for messages sent to MQTT
  -j MQTT_SUB_TOPICS [MQTT_SUB_TOPICS ...]
                        MQTT topics space-delimited: topic1 topic2 topic3
  -n PROCESS_NAME       Set process name in banner
  -p PUBLISHER_PORT     Publisher IP port
  -s SUBSCRIBER_PORT    Subscriber IP port
  -t LOOP_TIME          Event Loop Timer in seconds

</code></pre>

<p>When the MQTT Gateway is invoked, it automatically connects to both the Banyan Backplane and the MQTT Broker.</p>
<p>Before running the following examples, make sure that you
have a <a href="https://mosquitto.org/">mosquitto broker</a> and a <a href="../examples_intro/#starting-the-backplane">Python Banyan
Backplane</a> running.</p>
<h2 id="example-1-pure-mqtt-publish-and-subscribe">Example 1: Pure MQTT Publish And Subscribe</h2>
<p>This example will publish a simple MQTT message to be received by a simple
MQTT subscriber.</p>
<h3 id="mqtt-publisher">MQTT Publisher</h3>
<p>Below is the code for a simple <a href="https://github.com/MrYsLab/python_banyan/blob/master/examples/mqtt_gateway/pub.py">MQTT publisher</a>
 that publishes a single message and exits.</p>
<pre><code>import json

import paho.mqtt.client as mqtt

# This is a simple MQTT publisher example.
# It connects to an MQTT broker, builds a payload and
# then publishes the message with a topic of &quot;mqtt_network&quot;.

my_client = mqtt.Client()
my_client.connect(&quot;localhost&quot;, 1883, 60)
z = {'from_mqtt_client': 'hello'}

payload = json.dumps(z).encode()
my_client.publish(&quot;mqtt_network&quot;, payload)
my_client.disconnect()
</code></pre>

<h3 id="mqtt-subscriber">MQTT Subscriber</h3>
<p>The <a href="https://github.com/MrYsLab/python_banyan/blob/master/examples/mqtt_gateway/sub.py">MQTT subscriber</a>
 connects to an MQTT broker
and subscribes to 2 topics. The <strong>mqtt_network</strong> messages are for messages originated
on the MQTT network. The <strong>from_banyan</strong> messages are messages that were originated on the
Banyan network. For this first example, no messages are originated from the Banyan network.</p>
<pre><code>import paho.mqtt.client as mqtt
import json


# This is a simple MQTT subscriber example.
# It connects to an MQTT broker and
# subscribes to &quot;mqtt_network&quot; messages
# and prints a message when one is received.

def on_connect(client, userdata, flags, rc):
    print(&quot;Connected with result code &quot; + str(rc))
    client.subscribe(&quot;mqtt_network&quot;)
    client.subscribe(&quot;from_banyan&quot;)


def on_message(client, userdata, msg):
    m = msg.payload.decode()
    x = json.loads(m)
    print(x)


my_client = mqtt.Client()
my_client.connect(&quot;localhost&quot;, 1883, 60)

my_client.on_connect = on_connect
my_client.on_message = on_message

my_client.loop_forever()

</code></pre>

<p>First, we start the subscriber and then the publisher. The subscriber prints
any messages it receives. Here is the subscriber console output after
running the publisher:</p>
<pre><code>python3 sub.py
Connected with result code 0
{'from_mqtt_client': 'hello'}

</code></pre>

<h2 id="example-2-publishing-a-banyan-message-to-the-mqtt-network">Example 2: Publishing a Banyan Message To the MQTT Network</h2>
<p>Start the MQTT Gateway by opening a terminal window and typing:
mgw</p>
<p>The Gateway connects to the Python Backplane and the MQTT broker</p>
<pre><code>$ mgw

************************************************************
MqttGateway using Back Plane IP address: 192.168.2.189
Subscriber Port = 43125
Publisher  Port = 43124
Loop Time = 0.1 seconds
************************************************************
MQTT Gateway Connected to MQTT localhost:1883 with result code 0.

</code></pre>

<p>If it not already running, start the MQTT subscriber, sub.py.</p>
<p>To generate a message from Banyan to the MQTT network, we will use a Banyan component called
<a href="https://github.com/MrYsLab/python_banyan/blob/master/examples/mqtt_gateway/bpub.py">bpub.py:</a></p>
<pre><code>from python_banyan.banyan_base import BanyanBase


class Bpub(BanyanBase):
    &quot;&quot;&quot;
    This class will publish a message for the MqttGateway to forward to the MQTT network.
    &quot;&quot;&quot;

    def __init__(self):
        &quot;&quot;&quot;
        This is constructor for the Bpub class

        &quot;&quot;&quot;

        # initialize the base class
        super(Bpub, self).__init__(process_name='Bpub')

        # send a message to the MqttGateway
        self.publish_payload({'from_banyan': 'hello_mqtt_world'}, 'to_mqtt')

        # exit
        self.clean_up()


b = Bpub()
</code></pre>

<p>If we then start the <em>bpub.py</em> and look at the MQTT Subscriber's output, we see the message
from Banyan was sent out over MQTT and received by the MQTT subscriber:</p>
<pre><code>~/PycharmProjects/python_banyan$ python3 sub.py

Connected with result code 0
{'from_banyan': 'hello_mqtt_world'}
</code></pre>

<p>The Gateway received a Banyan message, translated it to an MQTT message,
 published this message on the MQTT network, and received the translated message by the MQTT subscriber.</p>
<h2 id="example-3-publishing-an-mqtt-message-to-the-banyan-network">Example 3: Publishing an MQTT Message To the Banyan Network</h2>
<p>In this example, an MQTT message will be published by pub.py.
The MQTT Gateway will receive this message. It will then translate
this message to a Banyan message and publish
the message to the Banyan network.</p>
<p>A Banyan component called <a href="https://github.com/MrYsLab/python_banyan/blob/master/examples/mqtt_gateway/bsub.py"><strong>bsub.py</strong></a> 
subscribes to receive the translated message and will publish it to the console.</p>
<p>To run this example, start the MQTT Gateway as we did in
<a href="../example10/#example-2-publishing-a-banyan-message-to-the-mqtt-network">Example 2.</a></p>
<p>Start bsub.py:</p>
<pre><code>python3 bsub.py
</code></pre>

<pre><code>from python_banyan.banyan_base import BanyanBase


class Bsub(BanyanBase):
    &quot;&quot;&quot;
    This class will receive any MQTT messages intercepted by MqttGateway
    &quot;&quot;&quot;

    def __init__(self):
        &quot;&quot;&quot;
        This is constructor for the Bpub class

        &quot;&quot;&quot;

        # initialize the base class
        super(Bsub, self).__init__(process_name='Bsub')

        # subscribe to receive MQTT messages processed
        # by the MqttGateway
        self.set_subscriber_topic('from_mqtt')

        # start the receive_loop
        self.receive_loop()

    def incoming_message_processing(self, topic, payload):
        print(topic, payload)


b = Bsub()

</code></pre>

<p>And finally, start the MQTT publisher pub.py</p>
<pre><code>python3 pub.py
</code></pre>

<p>Looking at the console for bsub.py, we see that the message was received from the MQTT
network and received by the Banyan network.</p>
<pre><code>python3 bsub.py

************************************************************
Bsub using Back Plane IP address: 192.168.2.189
Subscriber Port = 43125
Publisher  Port = 43124
Loop Time = 0.1 seconds
************************************************************
from_mqtt {'from_mqtt_client': 'hello'}
</code></pre>

<p><br>
<br>
Copyright (C) 2017-2020 Alan Yorinks All Rights Reserved</p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="example9.html" title="Tutorial 9 - Connecting To Multiple Backplanes" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Tutorial 9  - Connecting To Multiple Backplanes
              </div>
            </div>
          </a>
        
        
          <a href="example11.html" title="Tutorial 11 - Physical Computing And GPIO" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Tutorial 11 - Physical Computing And GPIO
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="assets/javascripts/vendor.a0c4167b.min.js"></script>
      <script src="assets/javascripts/bundle.fb26dd1d.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: ".",
          features: [],
          search: Object.assign({
            worker: "assets/javascripts/worker/search.37585f48.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>